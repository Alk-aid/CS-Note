# 1. 基于indoe的文件系统

1. `块设备`：存储设备被抽象为块设备
2. `块`：块设备的存储空间在逻辑上被划分为固定大小的存储块(block)。块是读写的最小单元，大小一般为4KB
3. `文件`: 文件被保存在一个个的块中，实际上是一个有名字的字符序列。使用`inode`记录一个文件对应的存储块
4. `文件元数据(file metadata)`：序列长度，序列的修改时间等描述文件数据的属性
5. `inode(index node)` :  

- 一个inode对应一个文件，记录了一个文件对应的所有存储块 以及 文件元数据
- inode采用`分级`的方式来组织块号，有直接指向数据库的直接指针，也有一级指针（对应文件最多2MB），二级指针（对应文件最多1GB）等
- 此外还有一个`nlink`，用来记录这个inode被多少个目录项所指向。nlink为0则会将inode和对应的数据进行删除

6. `目录项`: 记录了从文件名到inode号的映射
7. `目录`：由一个个目录项组成的特殊文件。

8. `文件系统`：实现文件接口并负责管理文件数据和元数据的系统

- 对上层来说，文件系统提供文件抽象和访问文件所需要的接口
- 对下层存储设备来说，文件系统维护文件的数据和元数据。

9. 硬链接 `ln file link` 和软连接  `ln -s file slink`

- 硬链接是创建一个目录项，指向源文件的index node；软链接是会创建一个保存着目标文件路径的文件，所以软连接会创建对应的文件，index node， 目录项；
- 硬链接的link 和 file是同等地位的，一个删了另外一个还能用；软连接的话，删除源文件，软连接就不能用。
- 软链接文件除了创建，删除和更新元数据以外，其本身只支持读取操作。

# 2. 虚拟文件系统

- 在计算机中可能同时存在多种文件系统，为了使得他们能在同一操作系统上共同工作，引入了虚拟文件系统(Virtual File System ,VFS)来对多种文件系统进行管理和协调。
- VFS定义了一系列内存数据结构，并要求底层的不同文件系统提供指定的方法，然后用这些方法将不同文件系统的元数据统一转换为VFS的内存数据结构，从而向上层提供统一的文件系统服务

- Virtual File System：通过基于inode设计了一系列数据结构，包括超级快，inode，目录项等，VFS隐蔽了实现细节。

# 3. 文件描述符

1. task_struct内部有一个文件描述符表，其中数组的下标就是文件描述符。
2. 通过文件描述符可以找到文件指针，进而找到打开文件表中对应的inode指针，从而通过inode找到文件对应的存储块

3. 文件描述符表每个进程都有一个，打开文件表和 i-node 表整个系统只有一个，它们三者之间的关系如下图所示。

![Linux文件描述符表示意图](http://aikaid-img.oss-cn-shanghai.aliyuncs.com/img/1-1Z4101H45S13.gif)

