# 1. 什么是操作系统

- 操作系统是一种系统应用，主要提供 `对硬件进行抽象和管理`，`为应用提供服务并进行管理`
- `对硬件进行管理和抽象`： 将有限的，离散的资源高效地抽象成无限的、连续的资源，并提交接口给上层系统调用。
  - 抽象：比如提供虚拟内存的概念，使得我们无需关心物理内存的硬件，位置，容量; 或者 虚拟文件系统
  - 管理：将各种硬件资源纳入统一的管理。比如通过设备驱动来管理各种外部设备的运行并处理可能的错误情况

- `为应用提供服务并进行管理`
  - 服务于应用：提供了不同层次，不同功能的接口（如系统调用）来满足应用的需求。使应用从繁杂的系统工作中解法出来
  - 管理应用：负责对应用生命周期的管理，包括应用的加载，启动，切换，调度，销毁等，从而保证应用间的公平性，性能与安全的隔离性

---

狭义的操作系统是操作系统内核加上一个Shell。

- 文件是对IO设备的抽象
- 虚拟内存是对程序存储器的抽象
- 进程是对一个正在运行的程序的抽象

# 2. 操作系统必要性

- 如果没有操作系统，应用直接和硬件打交道，缺少硬件资源管理和抽象功能，若是出现故障，可能引起直接崩溃，没有诊断和调试机会。如果自己实现一套对硬件的管理和抽象，那么本质上就是在使用操作系统的部分功能。----从硬件角度回答
- 如果一个应用希望直接控制硬件，依然还是需要操作系统的。因为应用加载与销毁，多个应用切换与隔离需要操作系统完成，并且操作系统可以从全局角度合理调度，高效利用硬件。                                 ----从应用角度回答

正是因为以上的管理能力，一个无限循环的打印程序不会卡死计算机，因为操作系统会对硬件资源按照优先级在不同硬件进行调度。但是fork炸弹依旧可以卡死计算机，但操作系统提供了给应用的资源设置配额的机制，限制一个应用能用的资源数量。

# 3. 操作系统接口

从应用角度来看，操作系统提供了不同层次的接口。

- 领域应用接口
- POSIX接口
- 系统调用接口

## 3.1 系统调用接口

1. 系统调用接口是 操作系统内核 提供的接口
2. 系统调用是**用户态应用**向**操作系统内核**请求服务的方法。

以printf为例

1. printf函数调用标准库libc的write函数
2. libc准备好相关参数后执行`svc指令`(陷入指令，是在`用户态`执行的)使得控制流从用户地址空间下陷到内核地址空间。
3. 操作系统内核下陷处理函数根据系统调用传入的第一个参数，识别出调用需要执行操作系统内核提供的sys_write函数，从系统调用表调用对应的函数。

![image-20220102135305859](http://aikaid-img.oss-cn-shanghai.aliyuncs.com/img/image-20220102135305859.png)

## 3.2 POSIX接口

1. 因为每个操作系统提供的系统调用各不相同
2. 为了同一个程序在不同操作系统的可移植性，逐渐形成了一些可移植操作系统接口标准，如POSIX（Portable Operating System Interface for Unix）
3. 这个标准通常通过C library实现，通常而言应用程序只需要调用libc接口就可以实现对操作系统功能的调用，并应用在类Unix系统上。

## 3.3 领域应用接口

在POSIX或操作系统调用的基础还可以封装面向不同领域的应用接口。为了开发的便捷性（复用功能），人们开始为各个应用领域定义应用开发接口与软件架构。例如安卓和苹果手机的应用开发接口。

# 4. 操作系统特征

1. 并发
2. 共享：资源共享,指系统中的资源可供内存中多个并发执行的进程共同使用。

- 互斥共享方式：同一时间只允许一个进程访问共享资源
- 同时访问方式：同一时间允许多个进程访问共享资源

3. 虚拟

- 空分复用技术(虚拟处理器)
- 时分复用技术(虚拟存储器)

4. 异步

- 多程序并发运行，但是由于资源有限，进程的执行不是一贯到底，而是走走停停，以不可预知的速度向前推进 

# 5. 内核

为什么需要内核

- 没有操作系统内核的话，每个应用都需要和硬件打交道，对接通信协议；所以通过操作系统内核作为硬件和应用的中间层
- 应用程序只需要关心和内核交互，不用关心硬件的细节

内核的功能

- 进程调度，内存管理，文件系统，设备管理，系统调用；

