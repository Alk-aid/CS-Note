# 1. Stream 流

## 1.1 设计思想

- 函数式编程思想, 被用来对集合进行链状流式的操作
- 将要处理的元素集合看作是一种流, 流中的元素不可变且只会被消费一次
- 可以在管道的节点上进行处理， 比如筛选， 排序，聚合
- 大多数中间操作都是垂直执行的, 但是和sorted 这样的是水平执行的

## 1.2 创建流

1. 适用对象: Collection 集合, 数组

2. 创建流的方式:

```java
// 1. 调用 stream()方法, 调用者为上述提到的适用对象
Arrays.asList("a1", "a2", "a3").stream() ;
// 2. 调用 Stream.of(T... values)方法
Stream.of("a1", "a2", "a3");

```

2. 中间操作 和 终端操作: 

- 中间操作: 会再次返回一个流, 所以可以执行链式操作, 如 filter过滤, map转换, sorted排序
- 终端操作: 对流操作的一个结束动作，一般返回 `void` 或者一个非流的结果 
- 中间操作的特性: 当且仅当存在终端操作时，中间操作操作才会被执行;

3. 流的处理顺序: 大多数数据都是垂直执行的, sorted 是水平执行的
4. 常见操作: 

## 终端操作

1. collect: 将流中的元素转变成另外一个不同的对象; 

```java
.collect(Collectors.toList()); // 生成一个新的 List

Map<Integer, List<Person>> personsByAge = persons
    .stream()
    .collect(Collectors.groupingBy(p -> p.age)); // 以年龄为 key,进行分组

personsByAge
    .forEach((age, p) -> System.out.format("age %s: %s\n", age, p));

// age 18: [Max]
// age 23: [Peter, Pamela]
// age 12: [David]

Double averageAge = persons
    .stream()
    .collect(Collectors.averagingInt(p -> p.age)); // 聚合出平均年龄

System.out.println(averageAge);     // 19.0
```



1. forEach:
2. reduce:

```
+--------------------+       +------+   +------+   +---+   +-------+
| stream of elements +-----> |filter+-> |sorted+-> |map+-> |collect|
+--------------------+       +------+   +------+   +---+   +-------+
```

以上的流程转换为 Java 代码为：

```java
List<String> myList =
    Arrays.asList("a1", "a2", "b1", "c2", "c1");

myList
    .stream() // 创建流
    .filter(s -> s.startsWith("c")) // 执行过滤，过滤出以 c 为前缀的字符串
    .map(String::toUpperCase) // 转换成大写
    .sorted() // 排序
    .forEach(System.out::println); // for 循环打印
```



