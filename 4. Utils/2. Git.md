

# 1. Git状态

git的四个工作区域：工作区，暂存区，版本库，远程仓库

- 工作区是对项目的某个版本独立提取出来的内容。 这些从 Git 仓库的压缩数据库中提取出来的文件，放在磁盘上供你使用或修改。
- 暂存区是一个文件，保存了下次将要提交的文件列表信息，一般在 Git 仓库目录中。 按照 Git 的术语叫做“索引”
- Git 仓库目录是 Git 用来保存项目的元数据和对象数据库的地方。 这是 Git 中最重要的部分，从其它计算机克隆仓库时，复制的就是这里的数据。

文件的分类：未追踪文件(Untracked) 和 已追踪文件(tracked)

- 将未追踪文件纳入到追踪中使用`git add [file]...`
- 已追踪文件(Git文件)有三种状态：Unmodified，modified，staged



![Git 下文件生命周期图。](http://aikaid-img.oss-cn-shanghai.aliyuncs.com/img/lifecycle.png)

# 2. 基础命令

1. 获取Git仓库

```shell
git init
# 命令会自动将其添加为远程仓库并默认以 “origin” 为简写,自动设置本地 master 分支跟踪克隆的远程仓库的 master 分支
git clone <url>
```

2. 查看文件状态

```shell
git status
# 输出中有两栏，左栏指明了暂存区的状态，右栏指明了工作区的状态。
git status -s
```

3. `追踪文件` or `暂存已修改文件` or 用于合并时把有冲突的文件标记为已解决状态（命令执行后 文件状态为staged）。

```shell
# git add命令 准确含义是：将内容添加到下一次提交中
git add <file or directory>
```

4. 忽略文件，使用.gitignore文件

```git
# 1. 星号（*）匹配零个或多个任意字符
# 2. [abc] 匹配任何一个列在方括号中的字符
# 3. 问号（?）只匹配一个任意字符；
# 4. 匹配模式可以以（`/`）开头防止递归; 匹配模式可以以（`/`）结尾指定目录。
# 5. 使用两个星号（**）表示匹配任意中间目录，比如 a/**/z 可以匹配 a/z 、 a/b/z 或 a/b/c/z 等。
```

```shell
# 忽略所有的 .a 文件
*.a

# 但跟踪所有的 lib.a，即便你在前面忽略了 .a 文件
!lib.a

# 只忽略当前目录下的 TODO 文件，而不忽略 subdir/TODO
/TODO

# 忽略任何目录下名为 build 的文件夹
build/

# 忽略 doc/notes.txt，但不忽略 doc/server/arch.txt
doc/*.txt

# 忽略 doc/ 目录及其所有子目录下的 .pdf 文件
doc/**/*.pdf
```

5. 查看已暂存和未暂存的修改

```shell
# 查看未暂存的修改, 此命令比较的是工作目录中当前文件和暂存区域快照之间的差异。
git diff
# 查看已暂存的修改, 这条命令将比对已暂存文件与最后一次提交的文件差异
git diff --staged
```

6. 提交暂存区的数据

```shell
git commit
# Git 就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过 git add 步骤：
git commit -a
```

7. 移除文件

```shell
# 1. 如果只是简单地从工作目录中手工删除文件，运行 git status 时就会在 Changes not staged for commit 的提示。
# git rm命令的本质就是rm 和 git add
# 2. 将文件从暂存区和工作区中删除：
git rm <file>
git rm -f <file>
# 3. 如果想把文件从暂存区域移除，但仍然希望保留在当前工作目录中，换句话说，仅是从跟踪清单中删除，使用 --cached 选项即可
git rm --cached <file>
```

8. 重命名

```shell
git mv file_from file_to
```

9. 查看提交历史

```shell
git log
# 显示每次提交所引入的差异（按 补丁 的格式输出）
git log -p/ -patch
# 限制日志的数量
git log -n
```

10. 撤销操作

- 第二次提交代替第一次提交的结果。

```shell
git commit -m 'initial commit'
git add forgotten_file
git commit --amend
```

- 将已经staged的数据撤销为modified状态

```shell
git reset HEAD <file>...
```

- 撤销修改，将它还原成上次提交时的样子(或者刚克隆完的样子，或者刚把它放入工作目录时的样子)

```shell 
git restore <file>...
```

11. 远程仓库操作

- 显示远程仓库

```shell
git remote
# 显示远程仓库的简称 和 对应的url
git remote -v
```

- 添加远程仓库

```shell
git remote add <shortname> <url>
```

- 从远程仓库获取资源

```shell
# 只会将数据下载到你的本地仓库——它并不会自动合并或修改你当前的工作区的文件
# 执行完成后，你将会拥有那个远程仓库中所有分支的引用，可以随时合并或查看。
git fetch <remote>
# git fetch + git merge
git pull <remote>
```

- 推送数据

```shell
# 只有当你有所克隆服务器的写入权限，并且之前没有人推送过时，这条命令才能生效。
git push <remote> <branch>
```

- 查看远程仓库信息

```shell
git remote show <remote>
```

- 重命名 和 移除

```shell
git remote rename <oldname> <newname>
git remote rm <name>
```

12. 打标签

- 列出标签

```shell
git tag 
git tag -l
# 通配符查询
git tag -l "v1.8.5*"
```

- 创建轻量级标签（lightweight）

```shell
# 轻量标签很像一个不会改变的分支——它只是某个特定提交的引用。
git tag <tagName>
```

- 创建附注标签（annotated）

```shell
# 其中包含打标签者的名字、电子邮件地址、日期时间， 此外还有一个标签信息
git tag -a <tagName> -m <message>
# 查看标签信息
git show <tagName>
```

- 查看标签

```shell
git show <tagName>
```

- 后期打标签

```shell
git tag -a <tagName> <checkSum>
```

- 推送标签

```shell
# 默认情况下，git push 命令并不会传送标签到远程仓库服务器上, 需要显示push
git push <remote> <tagname>
# 批量推送,把所有不在远程仓库服务器上的标签全部传送到那里。
git push origin --tags
```

- 删除标签

```shell
# 删除本地库的tag，没有删除远程库的
git tag -d <tagname>
# 删除远程库的tag
git push <remote> --delete <tagname>
```







# 3. 本地库操作

## 3.1 本地库初始化

1. 添加到暂存区 

   git add a.txt

2. 从暂存区到工作区 

   git rm --cached <file>

### 本地库操作

1. 提交到本地库 
   - git commit a.txt
   - git commit -m "日志" a.txt

2. 当对本地库中的内容修改后

![image-20210411004632774](https://gitee.com/aik-aid/picture/raw/master/image-20210411004632774.png)

​	- 可以使用git add 之后使用 git commit

​    - 也可以直接使用git commit

​	- git restore <file> 取消之前的修改

### 查看日志

1. git log  基本操作

2. git log --pretty=oneline 每个日志只显示一行

3. git log --oneline 第一种的简化版本 区别是这个只显示hash值的一部分
4. git reflog 其中HEAD@(移动到该版本所需要的步数)

![image-20210411100121851](https://gitee.com/aik-aid/picture/raw/master/image-20210411100121851.png)

---

### 版本前进和后退

#### 基于索引[推荐]

```git
git reset --hard 4985f94
```

#### 基于^

只能后退

```git
git reset --hard HEAD^ 后退一个版本
git reset --hard HEAD^^ 后退两个版本
git reset --hard HEAD^^^ 三个版本
```

#### 基于~

```git
git reset --hard HEAD~3 后退三个版本
```

### 比较差异

```git
git diff [文件名]  讲工作区的文件和暂存区进行比较
git diff [本地库的历史版本] [文件名] 讲工作区和历史版本比较
```

## 3.3 分支管理

### 3.3.1 什么是分支

在版本控制过程中，使用多条线同时推进多个任务

![image-20210411104534148](https://gitee.com/aik-aid/picture/raw/master/image-20210411104534148.png)

优点

- 同时并行推进多个功能开发，提高开发效率
- 各个分支在开发过程中，如果某一个分支开发失败，不会对其他分支有任何影响，失败的分支删除重新开始就行了

### 3.3.2 基本操作

#### 查看所有分支

```git 
git branch -v
```

#### 创建分支

```git 
git branch [名字]
```

#### 切换分支

```git
git checkout [分支名字]
```

#### 合并分支

1. 切换到接受修改的分支上
2. 执行merge命令 git merge [分支名]

### 3.3.3 分支冲突

![image-20210411110548118](https://gitee.com/aik-aid/picture/raw/master/image-20210411110548118.png)

解决

1. 编辑文件 删除特殊符号
2. 把文件修改到满意的程度
3. git add [文件名]
4. git commit -m "日志信息" **此时commit不带文件名**

# 4. Git的基本原理

哈希是一个系列的加密算法，各个不同的哈希算法虽然加密强度不同，但是有以下
几个共同点：

1. 不管输入数据的数据量有多大，输入同一个哈希算法，得到的加密结果长度固定。
2. 哈希算法确定，输入数据确定，输出数据能够保证不变
3. 哈希算法确定，输入数据有变化，输出数据一定有变化，而且通常变化很大
4. 哈希算法不可逆

Git 底层采用的是SHA-1 算法。

# 5. 远程库和本地库交互

## 准备操作

1. 创建本地仓库
2. 在github上创建远程仓库

3. 在本地库给远程库起别名

```git
git remote add [别名] [url]
```

## push

```git
git push [远程库别名] [本地库分支]
```

## clone

```git
git clone [url]
```

效果

1. 完整的把远程库下载到本地
2. 创建远程地址的别名(一般是origin)
3. 初始化本地库

## 邀请加入团队

## 拉取

fetch和merge的合并

### fetch

```git
git fetch [远程库别名] [远程分支名]
```

会在本地库创建一个分支

### merge

```git
git merge [远程库别名/远程分支名]
```

## 冲突

1. 如果不是基于Github远程库的最新版所做的修改，不能推送，必须先拉去

# 7. 面试

git init

git add

git commit



git pull = git fetch + git merge



回退：git reset

分支

- git branch
- git checkout
- git merge
