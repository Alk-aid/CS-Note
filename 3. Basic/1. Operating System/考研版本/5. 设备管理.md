# 1. I/O设备的基本概念和分类

![image-20210914140043578](https://gitee.com/aik-aid/picture/raw/master/image-20210914140043578.png)

# 2. I/O控制器

## 2.1 组成

I/O设备由机械部件和电子部件(I/O控制器)组成

- 机械部件主要用来执行具体I/O操作

> 如我们看得见摸得着的鼠标/键盘的按钮；显示器的LED屏；移动硬盘的磁臂、磁盘盘面。

- I/O设备的电子部件通常是一块插入主板扩充槽的印刷电路板。

## 2.2 I/O控制器

CPU无法直接控制I/O设备的机械部件，因此I/O设备还要有一个电子部件作为CPU和I/O设备机械部件之间的“中介”，用于实现CPU对设备的控制。

这个电子部件就是I/O控制器，又称设备控制器。CPU可控制I/O控制器，又由I/O控制器来控制设备的机械部件。

### 2.2.1 I/O控制器的功能

1. 接收和识别CPU发出的命令

> 如CPU发来的read/write命令，I/O控制器中会有相应的控制寄存器来存放命令和参数

2. 向CPU报告设备状态

> I/O控制器中会有相应的状态寄存器，用于记录I/O设备的当前状态。如：1表示空闲，0表示忙碌

3. 数据交换

> I/O控制器中会设置相应的数据寄存器。输出时，数据寄存器用于暂存CPU发来的数据，之后再由控制器传送设备。输入时，数据寄存器用于暂存设备发来的数据，之后CPU从数据寄存器中取走数据

4. 地址识别

> 类似于内存的地址，为了区分设备控制器中的各个寄存器，也需要给各个寄存器设置一个特定的“地址”。I/O控制器通过CPU提供的“地址”来判断CPU要读/写的是哪个寄存器

### 2.2.2 I/O控制器的组成

![image-20210914141716654](https://gitee.com/aik-aid/picture/raw/master/image-20210914141716654.png)

### 2.2.3 I/O寄存器的编址

1. 内存映像I/0

> 控制器中的寄存器和内存统一编址

2. 寄存器独立编址

> 控制器中的寄存器独立编址

# 3. I/O控制方式

## 3.1 程序直接控制方式

![image-20210914142608831](https://gitee.com/aik-aid/picture/raw/master/image-20210914142608831.png)

![image-20210914142545435](https://gitee.com/aik-aid/picture/raw/master/image-20210914142545435.png)

## 3.2 中断驱动方式

中断驱动方式可以解决CPU/IO设备只能串行工作的缺点

引入中断机制。由于I/O设备速度很慢，因此在CPU发出读/写命令后，可将等待I/O的进程阻塞，先切换到别的进程执行。

当I/O完成后，控制器会向CPU发出一个中断信号，CPU检测到中断信号后，会保存当前进程的运行环境信息，转去执行中断处理程序处理该中断。

处理中断的过程中，CPU从I/O控制器读一个字的数据传送到CPU寄存器，再写入主存。接着，CPU恢复等待I/O的进程（或其他进程）的运行环境，然后继续执行。

注意： 

1. CPU会在每个指令周期的末尾检查中断；
2. 中断处理过程中需要保存、恢复进程的运行环境，这个过程是需要一定时间开销的。可见，如果中断发生的频率太高，也会降低系统性能。

![image-20210914143205770](https://gitee.com/aik-aid/picture/raw/master/image-20210914143205770.png)

## 3.3 DMA方式

与“中断驱动方式”相比，DMA方式（Direct Memory Access，直接存储器存取。主要用于块设备的
I/O控制）有这样几个改进：

1. 数据的传送单位是“块”。不再是一个字、一个字的传送；
2. 数据的流向是从设备直接放入内存，或者从内存直接到设备。不再需要CPU作为“快递小哥”。
3. 仅在传送一个或多个数据块的开始和结束时，才需要CPU干预。

![image-20210914144017200](https://gitee.com/aik-aid/picture/raw/master/image-20210914144017200.png)

![image-20210914144033350](https://gitee.com/aik-aid/picture/raw/master/image-20210914144033350.png)

![image-20210914144048832](https://gitee.com/aik-aid/picture/raw/master/image-20210914144048832.png)

注意：

DMA微观上从磁盘读取数据也是一个字一个字读，然后放入DR，DR在一个字的存入内存。

> 因为内存的数据总线一次只能输入一个字的数据

## 3.4 通道控制方式

通道：一种硬件，可以理解为是“弱鸡版的CPU”。通道可以识别并执行一系列通道指令

![image-20210914153413685](https://gitee.com/aik-aid/picture/raw/master/image-20210914153413685.png)

![image-20210914153506455](https://gitee.com/aik-aid/picture/raw/master/image-20210914153506455.png)

# 4. I/O软件层次结构

