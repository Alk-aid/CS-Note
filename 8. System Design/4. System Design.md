# 1. 秒杀系统设计

秒杀特点: 短时间内，大量用户涌入，集中读和写有限的库存

1. 客户端优化

- 用户点击“查询”或者“购票”后，按钮置灰，禁止用户重复提交请求
- JS层面，限制用户在x秒之内只能提交一次请求

2. 站点层面的请求拦截（nginx层，写流控模块）

- 在站点层面，对uid进行请求计数和去重, 一个uid，5秒只准透过1个请求
- 对于5s内的无效请求，统一返回错误提示或错误页面

3. 服务层拦截

- 方案一: 写请求放到队列中，每次只透有限的写请求到数据层，如果成功了再放下一批，直到库存不够，队列里的写请求全部返回“已售完”
- 方案二: 采用漏斗机制，只放一倍的流量进来，多余的返回“已售完”，把写压力转换成读压力。 读请求，用cache，redis单机可以抗10W QPS,用异步线程定时更新缓存里的库存值

4. 数据库层

- 通过自身锁机制来控制，避免出现超卖